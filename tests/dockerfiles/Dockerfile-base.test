FROM alpine

ENV ALPINE_BASE=1

## dsuite user
ENV DST_USER="dsuite" \
	DST_GROUP="dsuite" \
	DST_UID="1000" \
	DST_GID="1000" \
    USER="dsuite"

## Create dsuite user and group
RUN \
	# Print executed commands
	set -x \
    # Group
    && addgroup -S -g "${DST_GID}" "${DST_GROUP}" \
    # User \
    && adduser -S -D -u "${DST_UID}" -G "${DST_GROUP}" -s /bin/bash "${DST_USER}" \
    # Add user to sudoers
    && echo "${DST_USER} ALL=(ALL) ALL" >> /etc/sudoers \
    && echo "${DST_USER} ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

## Copy files
COPY alpine-base/rootfs /
COPY alpine-base/install-base.sh /tmp/install-base.sh

## Install
RUN \
	# Print executed commands
	set -x \
    # Update repository indexes
    && apk update \
    # Run the install script
    && sh /tmp/install-base.sh local \
    # intsall packages
    && apk-install gnupg \
	# Clear apk's cache
	&& apk-cleanup

## Examples
COPY tests/alpine-base/rootfs /

## Entrypoint
ENTRYPOINT ["/entrypoint.sh"]
